DLABEL(string0) TIGER_STRING("ya pomnyu chudnoye mgnovenye")
DLABEL(string1) TIGER_STRING("   acdeeeghmmnnnnooopuuvyyyy")
DLABEL(string2) TIGER_STRING("uh oh, sorting gave the wrong answer")

#include <Tiger-stdlib-stack-data.hera>

CBON()
    INC(SP, 1)
    SET(R1, string0)
    STORE(R1, 2, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 2, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, mergesort0)
    LOAD(R1, 3, R12)
    DEC(SP, 4)
    STORE(R1, 0, FP)
    SET(R1, string1)
    STORE(R1, 1, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 0, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 1, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, tstrcmp)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
    SET(R1, 0)
    CMP(R2, R1)
    BZ(if_true0)
    SET(R2, 0)
    BR(end_if1)
  LABEL(if_true0)
    SET(R2, 1)
  LABEL(end_if1)
    CMP(R2, R0)
    BZ(if_false0)
    SET(R1, 42)
    STORE(R1, 0, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 0, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, printint)
    LOAD(R2, 3, R12)
    DEC(SP, 4)
    BR(end_if0)
  LABEL(if_false0)
    SET(R1, string2)
    STORE(R1, 0, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 0, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, println)
    LOAD(R2, 3, R12)
    DEC(SP, 4)
  LABEL(end_if0)
HALT()

#include <Tiger-stdlib-stack.hera>
LABEL(array_out_of_bounds0)
    print("attempted illegal array access... halting")
    HALT()
LABEL(nil_record0)
    print("attempted use of a nil record... halting")
    HALT()

LABEL(mergesort0)
    INC(SP, 10)
    STORE(R13, 0, FP)
    STORE(R12, 1, FP)
    STORE(R1, 4, FP)
    STORE(R2, 5, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 7, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 7, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, size)
    LOAD(R1, 3, R12)
    DEC(SP, 4)
    STORE(R1, 6, FP)
    LOAD(R2, 6, FP)
    SET(R1, 2)
    CMP(R2, R1)
    BL(if_false1)
    LOAD(R1, 6, FP)
    STORE(R1, 8, FP)
    SET(R1, 2)
    STORE(R1, 9, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 8, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 9, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, div)
    LOAD(R1, 3, R12)
    DEC(SP, 5)
    STORE(R1, 7, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 11, FP)
    SET(R1, 0)
    STORE(R1, 12, FP)
    LOAD(R1, 7, FP)
    STORE(R1, 13, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R1, 11, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 12, FP)
    STORE(R1, 4, R12)
    LOAD(R1, 13, FP)
    STORE(R1, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R1, 3, R12)
    DEC(SP, 6)
    STORE(R1, 10, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 10, FP)
    STORE(R1, 3, R12)
    LOAD(Rt, 2, FP)
    STORE(Rt, 2, R12)
    CALL(R12, mergesort0)
    LOAD(R1, 3, R12)
    DEC(SP, 4)
    STORE(R1, 8, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 11, FP)
    LOAD(R1, 7, FP)
    STORE(R1, 12, FP)
    LOAD(R2, 6, FP)
    LOAD(R1, 7, FP)
    SUB(R2, R2, R1)
    STORE(R2, 13, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R2, 11, FP)
    STORE(R2, 3, R12)
    LOAD(R2, 12, FP)
    STORE(R2, 4, R12)
    LOAD(R2, 13, FP)
    STORE(R2, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R2, 3, R12)
    DEC(SP, 6)
    STORE(R2, 10, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R2, 10, FP)
    STORE(R2, 3, R12)
    LOAD(Rt, 2, FP)
    STORE(Rt, 2, R12)
    CALL(R12, mergesort0)
    LOAD(R2, 3, R12)
    DEC(SP, 4)
    STORE(R2, 9, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R2, 8, FP)
    STORE(R2, 3, R12)
    LOAD(R2, 9, FP)
    STORE(R2, 4, R12)
    LOAD(Rt, 2, FP)
    STORE(Rt, 2, R12)
    CALL(R12, merge0)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
    BR(end_if2)
  LABEL(if_false1)
    LOAD(R2, 3, FP)
  LABEL(end_if2)
    STORE(R2, 3, FP)
    LOAD(R1, 4, FP)
    LOAD(R2, 5, FP)
    LOAD(R13, 0, FP)
    LOAD(R12, 1, FP)
    DEC(SP, 10)
    RETURN(R12, R13)
LABEL(merge0)
    INC(SP, 12)
    STORE(R13, 0, FP)
    STORE(R12, 1, FP)
    STORE(R1, 5, FP)
    STORE(R2, 6, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 9, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 9, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, size)
    LOAD(R1, 3, R12)
    DEC(SP, 4)
    STORE(R1, 7, FP)
    LOAD(R1, 4, FP)
    STORE(R1, 9, FP)
    MOVE(R12, SP)
    INC(SP, 4)
    LOAD(R1, 9, FP)
    STORE(R1, 3, R12)
    STORE(FP, 2, R12)
    CALL(R12, size)
    LOAD(R1, 3, R12)
    DEC(SP, 4)
    STORE(R1, 8, FP)
    LOAD(R2, 7, FP)
    SET(R1, 0)
    CMP(R2, R1)
    BNZ(if_false4)
    SET(R2, 1)
    BR(end_if6)
  LABEL(if_false4)
    LOAD(R2, 8, FP)
    SET(R1, 0)
    CMP(R2, R1)
    BZ(if_true2)
    SET(R2, 0)
    BR(end_if7)
  LABEL(if_true2)
    SET(R2, 1)
  LABEL(end_if7)
  LABEL(end_if6)
    CMP(R2, R0)
    BZ(if_false2)
    LOAD(R1, 3, FP)
    STORE(R1, 9, FP)
    LOAD(R1, 4, FP)
    STORE(R1, 10, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 9, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 10, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, concat)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
    BR(end_if3)
  LABEL(if_false2)
    LOAD(R1, 3, FP)
    STORE(R1, 13, FP)
    SET(R1, 0)
    STORE(R1, 14, FP)
    SET(R1, 1)
    STORE(R1, 15, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R1, 13, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 14, FP)
    STORE(R1, 4, R12)
    LOAD(R1, 15, FP)
    STORE(R1, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R1, 3, R12)
    DEC(SP, 6)
    STORE(R1, 9, FP)
    LOAD(R1, 4, FP)
    STORE(R1, 13, FP)
    SET(R1, 0)
    STORE(R1, 14, FP)
    SET(R1, 1)
    STORE(R1, 15, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R1, 13, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 14, FP)
    STORE(R1, 4, R12)
    LOAD(R1, 15, FP)
    STORE(R1, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R1, 3, R12)
    DEC(SP, 6)
    STORE(R1, 10, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 13, FP)
    SET(R1, 1)
    STORE(R1, 14, FP)
    LOAD(R2, 7, FP)
    SET(R1, 1)
    SUB(R2, R2, R1)
    STORE(R2, 15, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R2, 13, FP)
    STORE(R2, 3, R12)
    LOAD(R2, 14, FP)
    STORE(R2, 4, R12)
    LOAD(R2, 15, FP)
    STORE(R2, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R2, 3, R12)
    DEC(SP, 6)
    STORE(R2, 11, FP)
    LOAD(R1, 4, FP)
    STORE(R1, 13, FP)
    SET(R1, 1)
    STORE(R1, 14, FP)
    LOAD(R2, 8, FP)
    SET(R1, 1)
    SUB(R2, R2, R1)
    STORE(R2, 15, FP)
    MOVE(R12, SP)
    INC(SP, 6)
    LOAD(R2, 13, FP)
    STORE(R2, 3, R12)
    LOAD(R2, 14, FP)
    STORE(R2, 4, R12)
    LOAD(R2, 15, FP)
    STORE(R2, 5, R12)
    STORE(FP, 2, R12)
    CALL(R12, substring)
    LOAD(R2, 3, R12)
    DEC(SP, 6)
    STORE(R2, 12, FP)
    LOAD(R1, 9, FP)
    STORE(R1, 13, FP)
    LOAD(R1, 10, FP)
    STORE(R1, 14, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 13, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 14, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, tstrcmp)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
    SET(R1, 0)
    CMP(R2, R1)
    BL(if_true1)
    SET(R2, 0)
    BR(end_if5)
  LABEL(if_true1)
    SET(R2, 1)
  LABEL(end_if5)
    CMP(R2, R0)
    BZ(if_false3)
    LOAD(R1, 9, FP)
    STORE(R1, 13, FP)
    LOAD(R1, 11, FP)
    STORE(R1, 15, FP)
    LOAD(R1, 4, FP)
    STORE(R1, 16, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 15, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 16, FP)
    STORE(R1, 4, R12)
    LOAD(Rt, 2, FP)
    STORE(Rt, 2, R12)
    CALL(R12, merge0)
    LOAD(R1, 3, R12)
    DEC(SP, 5)
    STORE(R1, 14, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 13, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 14, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, concat)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
    BR(end_if4)
  LABEL(if_false3)
    LOAD(R1, 10, FP)
    STORE(R1, 13, FP)
    LOAD(R1, 3, FP)
    STORE(R1, 15, FP)
    LOAD(R1, 12, FP)
    STORE(R1, 16, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 15, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 16, FP)
    STORE(R1, 4, R12)
    LOAD(Rt, 2, FP)
    STORE(Rt, 2, R12)
    CALL(R12, merge0)
    LOAD(R1, 3, R12)
    DEC(SP, 5)
    STORE(R1, 14, FP)
    MOVE(R12, SP)
    INC(SP, 5)
    LOAD(R1, 13, FP)
    STORE(R1, 3, R12)
    LOAD(R1, 14, FP)
    STORE(R1, 4, R12)
    STORE(FP, 2, R12)
    CALL(R12, concat)
    LOAD(R2, 3, R12)
    DEC(SP, 5)
  LABEL(end_if4)
  LABEL(end_if3)
    STORE(R2, 3, FP)
    LOAD(R1, 5, FP)
    LOAD(R2, 6, FP)
    LOAD(R13, 0, FP)
    LOAD(R12, 1, FP)
    DEC(SP, 12)
    RETURN(R12, R13)
